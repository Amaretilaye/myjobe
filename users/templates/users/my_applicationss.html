
<!-- templates/my_applications.html -->
{% extends "users/base.html"%}
{% load static%}
{% block content %}
<main id="main" class="main">

    <div class="pagetitle">
      <h1>Profile</h1>
      <nav>
        <ol class="breadcrumb">
          <li class="breadcrumb-item"><a href="index.html">Home</a></li>
          <li class="breadcrumb-item">Users</li>
          <li class="breadcrumb-item active">Profile</li>
        </ol>
      </nav>
    </div><!-- End Page Title -->

   

    <a href="{% url 'applicants_pdf' %}" target="_blank">Download Applicants as PDF</a>

<table class="table table-striped">
    <thead>
        <tr>
            <th>applicants </th>
            <th>Job Title</th>
            <th>Resume</th>
            <th>Cover Letter</th>
            <th>Applied Date</th>
            <th>Status</th>
        </tr>
    </thead>
    <tbody>
        {% for applicant in applicants %}
        <tr>
            <td>{{ applicant.user.first_name }} {{ applicant.user.last_name }}</td>
            <td>{{ applicant.job.title }}</td>
            <td><a href="{{ applicant.resume.url }}" target="_blank">View Resume</a></td>
            <td>{{ applicant.cover_letter }}</td>
            <td>{{ applicant.applied_date }}</td>
            <td>
                <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
{% csrf_token %}

<!-- Status Dropdown -->
<select name="status" id="statusSelect_{{ applicant.id }}">
    <option value="applied" {% if applicant.status == 'applied' %}selected{% endif %} style="color: green;">Applied</option>
    <option value="shortlisted" {% if applicant.status == 'shortlisted' %}selected{% endif %} style="color: rgb(211, 214, 7);">Shortlisted</option>
    <option value="rejected" {% if applicant.status == 'rejected' %}selected{% endif %} style="color: rgb(128, 0, 0);">Rejected</option>
</select>

<!-- Hidden field for CSRF Token -->
<input type="hidden" id="csrf_token" value="{{ csrf_token }}">

<script>
    $(document).ready(function() {
        // Update color of dropdown based on selected option
        $("#statusSelect_{{ applicant.id }}").on("change", function() {
            var selectedOption = $(this).val();
            var selectedColor = $(this).find("option:selected").css("color");
            
            $(this).css("color", selectedColor);
            
            // Fetch CSRF token from hidden input
            var csrfToken = $("#csrf_token").val();
            
            $.ajax({
                url: "{% url 'update_status' applicant.id %}",
                type: "POST",
                data: {
                    'status': selectedOption,
                    'auto_submit': 1,
                    'csrfmiddlewaretoken': csrfToken
                },
              
                error: function(error) {
                    // Handle any errors here
                    console.error('Error:', error);
                }
            });
        }).trigger("change");  // Trigger change event initially to set color based on default selection
    });
</script>
          </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="6">No applicants found.</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

</main>
{% endblock%}